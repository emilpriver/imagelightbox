!function(e){"object"==typeof module&&"object"==typeof module.exports?e(require("jquery"),window,document):e(jQuery,window,document)}(function(P,Y,R){"use strict";var D=P("<div/>").attr("class","imagelightbox-loading").append(P("<div/>")),e=P("<button/>",{type:"button",class:"imagelightbox-arrow imagelightbox-arrow-left"}),t=P("<button/>",{type:"button",class:"imagelightbox-arrow imagelightbox-arrow-right"}),z=e.add(t),j=P("<div/>",{class:"imagelightbox-caption",html:"&nbsp;"}),N=P("<button/>",{type:"button",class:"imagelightbox-close"}),U=P("<div/>",{class:"imagelightbox-overlay"}),V=P("<a/>",{href:"#",class:"imagelightbox-navitem"}),K=P("<div/>",{class:"imagelightbox-nav"}),_=P("<div/>",{class:"imagelightbox-wrapper"}),H=P("body"),a=function(){var e=R.body||R.documentElement;return""===(e=e.style).WebkitTransition?"-webkit-":""===e.MozTransition?"-moz-":""===e.OTransition?"-o-":""===e.transition&&""},W=!1!==a(),$=function(e,t,i){var n={},o=a();n[o+"transform"]="translateX("+t+") translateY(-50%)",n[o+"transition"]=o+"transform "+i+"s ease-in",e.css(n)},B="ontouchstart"in Y,Q=Y.navigator.pointerEnabled||Y.navigator.msPointerEnabled,A=function(e){if(B)return!0;if(!Q||void 0===e||void 0===e.pointerType)return!1;if(void 0!==e.MSPOINTER_TYPE_MOUSE){if(e.MSPOINTER_TYPE_MOUSE!==e.pointerType)return!0}else if("mouse"!==e.pointerType)return!0;return!1},G=!1!=!!(R.fullscreenEnabled||R.webkitFullscreenEnabled||R.mozFullScreenEnabled||R.msFullscreenEnabled),J=!(!Y.history||!history.pushState);P.fn.imageLightbox=function(e){var i="",p=P([]),v=P(),b=P([]),r=-1,m=P(),x=0,E=0,y=0,w=!1,n=0,q=P.extend({selector:"a[data-imagelightbox]",id:"imagelightbox",allowedTypes:"png|jpg|jpeg|gif",animationSpeed:250,activity:!1,arrows:!1,button:!1,caption:!1,enableKeyboard:!0,history:!1,fullscreen:!1,gutter:10,offsetY:0,navigation:!1,overlay:!1,preloadNext:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,quitOnEscKey:!0},e),S=function(){q.activity&&u(),q.arrows&&z.css("display","block")},o=function(e,t,i){var n=t+"="+i,o="?"+n;if(e){var a=new RegExp("([?&])"+t+"=[^&]*");o=null!==e.match(a)?e.replace(a,"$1"+n):e+"&"+n}return o},a=function(){if(J&&q.history){var e=p[r].dataset.ilb2Id;e||(e=r);var t={imageLightboxIndex:e},i=p[r].dataset.imagelightbox;i&&(t.imageLightboxSet=i);var n=o(R.location.search,"imageLightboxIndex",e);i&&(n=o(n,"imageLightboxSet",i)),Y.history.pushState(t,"",R.location.pathname+n)}},t=function(e,t){var i=e;if(i){var n=new RegExp("[?]"+t+"=[^&]*"),o=new RegExp("&"+t+"=[^&]*");i=(i=i.replace(n,"?")).replace(o,"")}return i},l=function(e){var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(R.location.search);if(t&&t[2])return decodeURIComponent(t[2].replace(/\+/g," "))},c=function(){if(J&&q.history){var e=l("imageLightboxIndex");if(e){var t=p.filter('[data-ilb2-id="'+e+'"]');0<t.length?r=p.index(t):t=P(p[r=e]);var i=l("imageLightboxSet");!t[0]||i&&i!==t[0].dataset.imagelightbox||F(t,!0)}}},I=function(){if(--r<0){if(!0===q.quitOnEnd)return L(),!1;r=p.length-1}v=p.eq(r),a(),_.trigger("previous.ilb2",v),T(1)},k=function(){if(++r>=p.length){if(!0===q.quitOnEnd)return L(),!1;r=0}a(),v=p.eq(r),_.trigger("next.ilb2",v),T(-1)},s=function(){_.append(D)},u=function(){P(".imagelightbox-loading").remove()},g=function(){_.append(U)},h=function(){N.appendTo(_).on("click.ilb7",function(){return L(),!1})},d=function(){j.html("&nbsp;"),P(v).data("ilb2-caption")?j.html(P(v).data("ilb2-caption")):0<P(v).find("img").length&&j.html(P(v).find("img").attr("alt"))},f=function(){if(p.length){for(var e=0;e<p.length;e++)K.append(V.clone());var t=K.children("a");t.eq(p.index(v)).addClass("active"),_.on("previous.ilb2 next.ilb2",function(){t.removeClass("active").eq(p.index(v)).addClass("active")}),_.append(K),K.on("click.ilb7 touchend.ilb7",function(){return!1}).on("click.ilb7 touchend.ilb7","a",function(){var e=P(this);if(p.eq(e.index()).attr("href")!==P(".imagelightbox").attr("src")){var t=p.eq(e.index());t.length&&(n=p.index(v),v=t,T(e.index()<n?-1:1))}e.addClass("active").siblings().removeClass("active")})}},O=function(){_.append(z),z.on("click.ilb7 touchend.ilb7",function(e){return e.stopImmediatePropagation(),e.preventDefault(),P(this).hasClass("imagelightbox-arrow-left")?I():k(),!1})},C=function(){if(!m.length)return!0;var e=q.caption?j.outerHeight():0,a=P(Y).width(),r=P(Y).height()-e,l=Math.abs(1-q.gutter/100);function t(){if(a<x||r<E){var e=a/r<x/E?x/a:E/r;x/=e,E/=e}var t=E*l,i=x*l,n=(1+q.offsetY/100)*(P(Y).height()-t)/2,o=(P(Y).width()-i)/2;m.css({width:i+"px",height:t+"px",top:n+"px",left:o+"px"})}if(void 0!==m.get(0).videoWidth)return x=m.get(0).videoWidth,E=m.get(0).videoHeight,void t();var i=new Image;i.src=m.attr("src"),i.onload=function(){x=i.width,E=i.height,t()}},T=function(f){if(w)return!1;if(m.length){var e={opacity:0};W?$(m,100*f-y+"px",q.animationSpeed/1e3):e.left=parseInt(m.css("left"))+100*f+"px",m.animate(e,q.animationSpeed,function(){X()}),y=0}w=!0,q.activity&&s(),q.caption&&d(),setTimeout(function(){var e,t,i=v.attr("href"),n=0,o=0,a=0,r=!1,l=!1,c=0,s=0,u=!1,g=1,h=1;function d(){var e={opacity:1};if(m.appendTo(_),C(),m.css("opacity",0),W)$(m,-100*f+"px",0),setTimeout(function(){$(m,"0px",q.animationSpeed/1e3)},50);else{var t=parseInt(m.css("left"));e.left=t+"px",m.css("left",t-100*f+"px")}if(m.animate(e,q.animationSpeed,function(){w=!1,S()}),q.preloadNext){var i=p.eq(p.index(v)+1);i.length||(i=p.eq(0)),P("<img />").attr("src",i.attr("href"))}_.trigger("loaded.ilb2")}v.data("ilb2Video")?b.each(function(){this.i===v.data("ilb2VideoId")&&(e=this.l,t=this.e,this.a&&(!1===e&&t.attr("autoplay",this.a),!0===e&&t.get(0).play()))}):t=P("<img id='"+q.id+"' />").attr("src",i),m=t.on("load.ilb7",d).on("error.ilb7",function(){S()}).on(Q?"pointerup.ilb7 MSPointerUp.ilb7":"click.ilb7",function(e){return e.preventDefault(),q.quitOnImgClick?(L(),!1):!!A(e.originalEvent)||void((e.pageX||e.originalEvent.pageX)-e.target.offsetLeft<x/2?I():k())}).on("touchstart.ilb7 pointerdown.ilb7 MSPointerDown.ilb7",function(e){if(!A(e.originalEvent)||q.quitOnImgClick)return!0;"touchstart"==e.type&&2==e.originalEvent.touches.length&&(r=!0,h=Math.sqrt((e.originalEvent.touches[0].screenX-e.originalEvent.touches[1].screenX)*(e.originalEvent.touches[0].screenX-e.originalEvent.touches[1].screenX)+(e.originalEvent.touches[0].screenY-e.originalEvent.touches[1].screenY)*(e.originalEvent.touches[0].screenY-e.originalEvent.touches[1].screenY)),console.log(h)),l||(W&&(a=parseInt(m.css("left"))),n=e.originalEvent.pageX||e.originalEvent.touches[0].pageX),l&&1==e.originalEvent.touches.length&&(c=e.originalEvent.touches[0].screenX,s=e.originalEvent.touches[0].screenY,u=!0)}).on("touchmove.ilb7 pointermove.ilb7 MSPointerMove.ilb7",function(e){if(!l){if(!Q&&"pointermove"===e.type||!A(e.originalEvent)||q.quitOnImgClick)return!0;e.preventDefault(),o=e.originalEvent.pageX||e.originalEvent.touches[0].pageX,y=n-o,W?$(m,-y+"px",0):m.css("left",a-y+"px")}u&&(m.css({top:parseInt(m.css("top"))+e.originalEvent.touches[0].screenY-s+"px",left:parseInt(m.css("left"))+e.originalEvent.touches[0].screenX-c+"px"}),c=e.originalEvent.touches[0].screenX,s=e.originalEvent.touches[0].screenY),r&&(g=Math.sqrt((e.originalEvent.touches[0].screenX-e.originalEvent.touches[1].screenX)*(e.originalEvent.touches[0].screenX-e.originalEvent.touches[1].screenX)+(e.originalEvent.touches[0].screenY-e.originalEvent.touches[1].screenY)*(e.originalEvent.touches[0].screenY-e.originalEvent.touches[1].screenY))/h,m.css({width:x*g+"px",height:E*g+"px",top:(P(Y).height()-E*g)/2+"px",left:(P(Y).width()-x*g)/2+"px"}),l=!0)}).on("touchend.ilb7 touchcancel.ilb7 pointerup.ilb7 pointercancel.ilb7 MSPointerUp.ilb7 MSPointerCancel.ilb7",function(e){if(!l){if(!A(e.originalEvent)||q.quitOnImgClick)return!0;50<Math.abs(y)?y<0?I():k():W?$(m,"0px",q.animationSpeed/1e3):m.animate({left:a+"px"},q.animationSpeed/2)}if(u&&(u=!1),r&&(r=!1,h=1,l&&g<=1)){var t=Math.abs(1-q.gutter/100);m.css({width:x*t+"px",height:E*t+"px",top:(1+q.offsetY/100)*(P(Y).height()-E*t)/2,left:(P(Y).width()-x*t)/2}),l=!1}}),!0===e&&d(),!1===e&&(m=m.on("loadedmetadata.ilb7",d))},q.animationSpeed+100)},X=function(){if(!m.length)return!1;m.remove(),m=P()},F=function(e,t){if(w)return!1;w=!1,v=e,r=p.index(v),t||a(),function(){q.arrows&&O(this),q.navigation&&f(),q.overlay&&g(),q.button&&h(),q.caption&&_.append(j)}(),H.append(_).addClass("imagelightbox-open"),_.trigger("start.ilb2",e),T(0)},L=function(e){if(r=-1,e||function(){if(J&&q.history){var e=t(R.location.search,"imageLightboxIndex");e=t(e,"imageLightboxSet"),Y.history.pushState({},"",R.location.pathname+e)}}(),_.trigger("quit.ilb2"),H.removeClass("imagelightbox-open"),!m.length)return!1;m.animate({opacity:0},q.animationSpeed,function(){X(),w=!1,_.remove().find("*").remove()})},M=function(t){t.each(function(){p=t.add(P(this))}),t.on("click.ilb7",{set:i},function(e){e.preventDefault(),i=P(e.currentTarget).data("imagelightbox"),t.filter(function(){return P(this).data("imagelightbox")===i}).filter(function(){return e=P(this),"a"===P(e).prop("tagName").toLowerCase()&&(new RegExp(".("+q.allowedTypes+")$","i").test(P(e).attr("href"))||P(e).data("ilb2Video"));var e}).each(function(){p=p.add(P(this))}),p.length<1?L():F(P(this))})};return P(Y).on("resize.ilb7",C),J&&q.history&&P(Y).on("popstate",function(e){var t=e.originalEvent.state;if(t){var i=t.imageLightboxIndex;if(void 0!==i){var n=p.filter('[data-ilb2-id="'+i+'"]');if(0<n.length)var o=p.index(n);else n=P(p[o=i]);if(n[0]&&(!t.imageLightboxSet||t.imageLightboxSet===n[0].dataset.imagelightbox))if(r<0)F(n,!0);else{var a=1;r<o&&(a=-1),v=n,r=o,T(a)}}else L(!0)}else L(!0)}),P(R).ready(function(){q.quitOnDocClick&&P(R).on(B?"touchend.ilb7":"click.ilb7",function(e){m.length&&!P(e.target).is(m)&&(e.preventDefault(),L())}),q.fullscreen&&G&&P(R).on("keydown.ilb7",function(e){if(!m.length)return!0;var t;-1<[9,32,38,40].indexOf(e.which)&&(e.stopPropagation(),e.preventDefault()),-1<[13].indexOf(e.which)&&(e.stopPropagation(),e.preventDefault(),(t=R.getElementById(q.id).parentElement).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen(),R.exitFullscreen?R.exitFullscreen():R.mozCancelFullScreen?R.mozCancelFullScreen():R.webkitExitFullscreen&&R.webkitExitFullscreen())}),q.enableKeyboard&&P(R).on("keydown.ilb7",function(e){if(!m.length)return!0;-1<[27].indexOf(e.which)&&q.quitOnEscKey&&(e.stopPropagation(),e.preventDefault(),L()),-1<[37].indexOf(e.which)&&(e.stopPropagation(),e.preventDefault(),I()),-1<[39].indexOf(e.which)&&(e.stopPropagation(),e.preventDefault(),k())})}),P(R).off("click",q.selector),M(P(this)),c(),p.each(function(){var e=P(this).data("ilb2Video");if(e){var t=P(this).data("ilb2Id");t||(t="a"+(65536*(1+Math.random())|0).toString(16)),P(this).data("ilb2VideoId",t);var n={e:P("<video id='"+q.id+"' preload='metadata'>"),i:t,l:!1,a:void 0};P.each(e,function(e,t){"autoplay"===e?n.a=t:"sources"!==e&&(n.e=n.e.attr(e,t))}),e.sources&&P.each(e.sources,function(e,t){var i=P("<source>");P.each(t,function(e,t){i=i.attr(e,t)}),n.e.append(i)}),n.e.on("loadedmetadata.ilb7",function(){n.l=!0}),b=b.add(n)}}),this.addToImageLightbox=function(e){M(e)},this.openHistory=function(){c()},this.loadPreviousImage=function(){I()},this.loadNextImage=function(){k()},this.quitImageLightbox=function(){return L(),this},this.startImageLightbox=function(e){e?e.trigger("click.ilb7"):P(this).trigger("click.ilb7")},this}});